# WordPress Deep Dive Auto-Publishing - 2026-01-21

## Summary

Configured WordPress Deep Dives (long-form analysis posts) to auto-publish instead of requiring manual review. Set up automated daily publishing schedule at 10am.

## Changes Made

### 1. WordPress Endpoint Support ‚úÖ
**File**: `send-pending-to-wordpress.js`

**Problem**: Script was hardcoded to publish only to `/insight` endpoint
**Solution**: Made endpoint dynamic based on client type

```javascript
// Choose endpoint based on client type
const endpoint = clientType === 'wordpress_deepdive' ? 'analysis' : 'insight';

const response = await fetch(`${baseUrl}/wp-json/wp/v2/${endpoint}`, {
    // ...
});
```

**Result**: Deep dives publish to `/analysis` post type, insights to `/insight`

### 2. Publish Status Change ‚úÖ
**File**: `wordpress-prompts.json`

**Changed**:
- Line 17: `"publish_status": "draft"` ‚Üí `"publish_status": "publish"`
- Line 16: `"schedule": "manual_review"` ‚Üí `"schedule": "daily"`

**Impact**: New deep dive broadcasts will auto-publish instead of requiring manual review

### 3. Publishing Rate Optimization ‚úÖ
**File**: `send-pending-to-wordpress.js`

**Problem**: Same LIMIT (9) for both insights and deep dives
**Solution**: Dynamic limit based on content type

```javascript
// Insights: 9 articles per run (6 runs/day * 9 = 54 articles/day)
// Deep Dives: 2 articles per run (1 run/day * 2 = 2 analyses/day)
const limit = CLIENT_FILTER === 'wordpress_deepdive' ? 2 : 9;
```

**Rationale**: Deep dives are 2000-4000 words (vs 800-1200 for insights), so lower volume is appropriate

### 4. Updated Existing Broadcasts ‚úÖ
**File**: `update-deepdive-publish-status.js` (new script)

**Problem**: 141 pending deep dive broadcasts had old "draft" status baked in
**Solution**: Batch update script to change publish_status in JSON content

**Result**: 141/141 broadcasts updated successfully

### 5. Cron Schedule Added ‚úÖ
**File**: `crontab`

**Added**:
```bash
# Publish WordPress Deep Dives (daily at 10am) - Node 23.3.0, publishes 2 analyses/day
0 10 * * * cd /Users/davidlockie/Documents/Projects/Eliza && WP_BASE_URL=http://localhost:8885 CLIENT=wordpress_deepdive /Users/davidlockie/.nvm/versions/node/v23.3.0/bin/node send-pending-to-wordpress.js >> logs/cron-wordpress-deepdives.log 2>&1
```

**Schedule**: Once daily at 10:00 AM (vs every 4 hours for insights)

## Publishing Schedules

| Content Type | Frequency | Articles/Run | Daily Total | Post Type |
|--------------|-----------|--------------|-------------|-----------|
| Daily Insights | Every 4 hours (6x/day) | 9 | 54 | `/insight` |
| Deep Dives | Daily at 10am (1x/day) | 2 | 2 | `/analysis` |

## Current Status

### WordPress Analysis Posts
- **Total**: 14 posts
- **Published**: 4 posts
- **Drafts**: 10 posts (from pre-update testing)

### Broadcast Pipeline
- **Pending Deep Dives**: 139 broadcasts (41.2% avg alignment)
- **Sent Deep Dives**: 12 broadcasts (87.1% avg alignment - excellent quality!)
- **All configured to auto-publish**: ‚úÖ

### Test Results
Successfully published 2 deep dives with auto-publish:
1. "Deep Dive: DARPA GO's Generative Optogenetics Pioneers Brain Control"
   - URL: http://localhost:8885/analysis/deep-dive-darpa-gos-generative-optogenetics-pioneers-brain-control/
   - Status: ‚úÖ Published (not draft)

2. "Deep Dive: DARPA GO Generative Optogenetics: Transforming Neural Control"
   - URL: http://localhost:8885/analysis/deep-dive-darpa-go-generative-optogenetics-transforming-neural-control/
   - Status: ‚úÖ Published (not draft)

## Files Created/Modified

### Created
1. `update-deepdive-publish-status.js` - Batch update script for existing broadcasts

### Modified
1. `send-pending-to-wordpress.js` - Dynamic endpoint + dynamic LIMIT
2. `wordpress-prompts.json` - Changed deep_dive publish_status to "publish"
3. `crontab` - Added daily deep dive publishing schedule

## Impact

### Before
- Deep dives: Manual review required (drafts)
- Publishing: Manual workflow
- Volume: 0 deep dives published automatically
- Pipeline: 151 pending, 0 flowing

### After
- Deep dives: Auto-publish ‚úÖ
- Publishing: Fully automated daily at 10am
- Volume: 2 deep dives/day (appropriate for long-form content)
- Pipeline: 139 pending, flowing at steady rate

### Expected Timeline
- **Current backlog**: 139 pending deep dives
- **Publishing rate**: 2 per day
- **Clearance time**: ~70 days
- **New generation**: Continues via broadcast creation (every 6 hours)

## Future Broadcasts

All new deep dive broadcasts generated by `process-unprocessed-docs.js` will:
- ‚úÖ Have `publish_status: "publish"` in their JSON
- ‚úÖ Auto-publish when sent to WordPress
- ‚úÖ Use `/analysis` post type
- ‚úÖ Include featured images
- ‚úÖ Include bio theme categories
- ‚úÖ Include alignment scores

## Quality Control

Deep dives maintain high quality through:
1. **Alignment threshold**: 25% minimum (vs 20% for insights)
2. **Average quality**: 87.1% alignment for sent broadcasts
3. **LLM generation**: Comprehensive 2000-4000 word analysis
4. **Automated scheduling**: Steady 2/day rate prevents overwhelming readers

## Monitoring

**Log file**: `logs/cron-wordpress-deepdives.log`

**Check status**:
```bash
# View recent deep dive publishes
tail -f logs/cron-wordpress-deepdives.log

# Check pending count
sqlite3 agent/data/db.sqlite "SELECT COUNT(*) FROM broadcasts WHERE client = 'wordpress_deepdive' AND status = 'pending'"

# Check WordPress analysis posts
curl -s 'http://localhost:8885/wp-json/wp/v2/analysis?per_page=100' | jq 'length'
```

## Next Steps

1. ‚úÖ Auto-publishing configured and tested
2. ‚úÖ Cron schedule active (starts tomorrow at 10am)
3. ‚è≠Ô∏è Monitor first automated run (2026-01-22 10:00 AM)
4. ‚è≠Ô∏è Review published deep dives for quality
5. ‚è≠Ô∏è Adjust publishing rate if needed (currently 2/day)

---

**Status**: ‚úÖ COMPLETE
**Impact**: HIGH - WordPress now has dual content streams (54 insights/day + 2 analyses/day)
**Next automated run**: 2026-01-22 10:00 AM

üöÄ WordPress Deep Dive publishing fully automated!
